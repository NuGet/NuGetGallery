@model SubmitPackageRequest
@{
    ViewBag.Title = "Upload Package";
    ViewBag.Tab = "Upload";
    Layout = "~/Views/Shared/Gallery/Layout.cshtml";
}

<div class="page-upload container main-container">
    <h1 class="page-heading col-xs-10 col-xs-offset-1 text-center">Upload Your Package</h1>
    <div class="page-subheading col-xs-10 col-xs-offset-1 text-center">
        <p class="message">Your package file will be uploaded and hosted on the @(Config.Current.Brand) server (@(Config.Current.SiteRoot)).</p>
    </div>
    <div class="col-xs-10 col-xs-offset-1" id="upload-package-container">
        <h2>
            <a href="#" role="button" data-toggle="collapse" data-target="#upload-package-form"
               aria-expanded="false" aria-controls="upload-package-form" id="show-upload-package-form">
                <i class="ms-Icon ms-Icon--ChevronDown" aria-hidden="true"></i>
                <span>Upload</span>
            </a>
        </h2>
        <div class="collapse in" id="upload-package-form" aria-expanded="true">
            <form id="cancel-form">
                @Html.AntiForgeryToken()
            </form>
            <form id="uploadForm" enctype="multipart/form-data">
                @Html.AntiForgeryToken()

                @Html.ValidationSummary(true)

                <div class="input-group">
                    <input type="text" class="form-control" id="file-select-feedback" placeholder="Browse to select a package file..." readonly />
                    <label for="input-select-file" id="PackageFileLabel" class="input-group-btn">
                        <span class="btn btn-primary">
                            Browse&hellip;<input type="file" name="UploadFile" accept=".nupkg" aria-labelledby="PackageFileLabel" id="input-select-file" style="display:none;" />
                        </span>
                    </label>
                </div>
            </form>

            <div id="upload-progress-bar-container" class="progress">
                <div id="upload-progress-bar" class="progress-bar active" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            <div id="validation-failure-container">
            </div>
        </div>
    </div>


    @if (Model != null && Model.IsUploadInProgress)
    {
        <div class="col-xs-10 col-xs-offset-1" id="warning-container">
            @ViewHelpers.AlertWarning(@<text>You had an upload in progress. You can continue it here or cancel to restart.</text>)
        </div>
    }
    <div class="col-xs-10 col-xs-offset-1" id="verify-package-container">
    </div>

    @Html.Partial("_EditMetadata")
</div>

@section BottomScripts
{
    @* Right now this is the only page that uses this script. If we increase our usage of it, we should put it in our bundles *@
    <script type="text/javascript" src="@Url.Content("~/Scripts/async-file-upload.js")"></script>
    <script type="text/javascript">
        var InProgressPackage = @Html.Raw(Json.Encode(Model.InProgressUpload));
        $("#upload-progress-bar-container").hide();
        $("#validation-failure-container").hide();
        window.nuget.configureExpander(
            "upload-package-form",
            "ChevronRight",
            "Upload",
            "ChevronDown",
            "Upload");
        $(function () {
            AsyncFileUploadManager.init(
                '@Url.Action(actionName: "UploadPackageProgress", controllerName: "Packages")',
                'uploadForm',
                '@Scripts.Url("~/Scripts/jquery")',
                '@Url.Action(actionName: "UploadPackage", controllerName: "Packages")',
                '@Url.Action(actionName: "CancelUpload", controllerName: "Packages")',
                '@Url.Action(actionName: "VerifyPackage", controllerName: "Packages")');
        });
    </script>
}
